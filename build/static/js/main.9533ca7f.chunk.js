(this["webpackJsonpbloglist-frontend"]=this["webpackJsonpbloglist-frontend"]||[]).push([[0],{87:function(t,e,n){},88:function(t,e,n){"use strict";n.r(e);var r,a=n(0),c=n.n(a),i=n(19),o=n.n(i),u=n(5),s=n.n(u),l=n(7),d=n(16),j=n(9),v=n(8),b=n(28),f=n(37),p=n(12),h=n.n(p),O="loggedBlogappUser",x={saveUser:function(t){localStorage.setItem(O,JSON.stringify(t))},loadUser:function(){JSON.parse(localStorage.getItem(O))},logoutUser:function(){localStorage.removeItem(O)}},g="/api/blogs",m=function(){return{headers:{Authorization:"bearer ".concat(x.loadUser().token)}}},y={create:function(){var t=Object(l.a)(s.a.mark((function t(e){var n;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h.a.post(g,e,m);case 2:return n=t.sent,t.abrupt("return",n.data);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),remove:function(){var t=Object(l.a)(s.a.mark((function t(e,n){var r;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h.a.delete("".concat(g,"/").concat(e),m,n);case 2:return r=t.sent,t.abrupt("return",r.data);case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),update:function(){var t=Object(l.a)(s.a.mark((function t(e){var n,r;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={title:e.title,author:e.author,url:e.url,likes:e.likes},t.next=3,h.a.put("".concat(g,"/").concat(e.id),m,n);case 3:return r=t.sent,t.abrupt("return",r.data);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),getOne:function(){var t=Object(l.a)(s.a.mark((function t(e){var n;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h.a.get("".concat(g,"/").concat(e));case 2:return n=t.sent,t.abrupt("return",n.data);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),getAll:function(){var t=Object(l.a)(s.a.mark((function t(){var e;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h.a.get(g);case 2:return e=t.sent,t.abrupt("return",e.data);case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},w=function(t){return{type:"INIT_BLOGS",data:{id:t.id,title:t.title,author:t.author,url:t.url,likes:t.likes,user:t.user}}},k=function(){return function(){var t=Object(l.a)(s.a.mark((function t(e){var n;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,y.getAll();case 2:n=t.sent,e({type:"INIT_BLOGS",data:n});case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},E=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1?arguments[1]:void 0;switch(console.log("ACTION:",e),console.log("STATE NOW:",t),e.type){case"NEW_BLOG":return[].concat(Object(f.a)(t),[e]);case"INIT_BLOGS":var n=e.data,r=n.map(w);return r;case"UPDATE_BLOG":var a,c,i,o,u,s,l=e.data,d=t.find((function(t){var e;return(null===(e=t.data)||void 0===e?void 0:e.id)===l})),j=Object(b.a)(Object(b.a)({},d),{},{data:{id:null===(a=d.data)||void 0===a?void 0:a.id,likes:(null===(c=d.data)||void 0===c?void 0:c.likes)+1,title:null===(i=d.data)||void 0===i?void 0:i.title,author:null===(o=d.data)||void 0===o?void 0:o.author,url:null===(u=d.data)||void 0===u?void 0:u.author,user:null===(s=d.data)||void 0===s?void 0:s.user}});return t.map((function(t){var e;return(null===(e=t.data)||void 0===e?void 0:e.id)===l?j:t}));case"REMOVE_BLOG":var v=e.data;return t.filter((function(t){var e;return(null===(e=t.data)||void 0===e?void 0:e.id)!==v}));default:return t}},N=function(t,e){return function(){var n=Object(l.a)(s.a.mark((function n(a){return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:a({type:"NEW_MESSAGE",data:{message:t}}),r&&clearTimeout(r),r=setTimeout((function(){a({type:"REMOVE_MESSAGE"})}),1e3*e);case 3:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}()},S=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0;switch(console.log("STATE NOW:",t),console.log("ACTION:",e),e.type){case"NEW_MESSAGE":return e.data;case"REMOVE_MESSAGE":return null;default:return t}},T=n(90),I="/api/blogs",A=null,C={setToken:function(t){A="bearer ".concat(t)},create:function(){var t=Object(l.a)(s.a.mark((function t(e,n){var r,a,c;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r={headers:{Authorization:A}},a={content:n},t.next=4,h.a.post("".concat(I,"/").concat(e,"/comments"),a,r);case 4:return c=t.sent,t.abrupt("return",c.data);case 6:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),remove:function(){var t=Object(l.a)(s.a.mark((function t(e,n){var r,a;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r={headers:{Authorization:A}},t.next=3,h.a.delete("".concat(I,"/").concat(e),r,n);case 3:return a=t.sent,t.abrupt("return",a.data);case 5:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),update:function(){var t=Object(l.a)(s.a.mark((function t(e,n){var r,a;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r={headers:{Authorization:A}},t.next=3,h.a.put("".concat(I,"/").concat(e),r,n);case 3:return a=t.sent,t.abrupt("return",a.data);case 5:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),getOne:function(){var t=Object(l.a)(s.a.mark((function t(e){var n;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h.a.get("".concat(I,"/").concat(e));case 2:return n=t.sent,t.abrupt("return",n.data);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),getAll:function(){var t=Object(l.a)(s.a.mark((function t(e){var n;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h.a.get("".concat(I,"/").concat(e,"/comments"));case 2:return n=t.sent,t.abrupt("return",n.data);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},L=function(t,e){return function(){var n=Object(l.a)(s.a.mark((function n(r){var a,c;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,C.create(null===(a=t.data)||void 0===a?void 0:a.id,e);case 2:c=n.sent,r({type:"NEW_COMMENT",data:c});case 4:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}()},_=function(t){return function(){var e=Object(l.a)(s.a.mark((function e(n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.getAll(t);case 2:r=e.sent,n({type:"INIT_COMMENTS",data:{id:r.id,title:r.title,author:r.author,url:r.url,likes:r.likes,user:r.user,comments:r.comments}});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},M=function(){var t,e,n,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1?arguments[1]:void 0;switch(console.log("ACTION:",a),console.log("STATE NOW:",r),a.type){case"NEW_COMMENT":return[].concat(Object(f.a)(null===(t=r.data)||void 0===t?void 0:t.comments),[{content:null===(e=a.data)||void 0===e?void 0:e.content,id:null===(n=a.data)||void 0===n?void 0:n.id}]);case"INIT_COMMENTS":return a;default:return r}},B=n(1),U=function(){var t,e,n,r,c,i,o,u=Object(v.b)(),d=Object(v.c)((function(t){return t.user})),b=Object(v.c)((function(t){return t.blogs})),f=Object(j.f)().id;Object(a.useEffect)((function(){u(_(f));var t=setInterval((function(){u(_(f))}),1e4);return function(){return clearInterval(t)}}),[u,f]);var p=b.sort((function(t,e){return e.likes-t.likes})).find((function(t){var e;return(null===(e=t.data)||void 0===e?void 0:e.id)===f}));if(!p)return null;return Object(B.jsxs)("div",{children:[Object(B.jsxs)("h2",{children:[null===(t=p.data)||void 0===t?void 0:t.title," ",null===(e=p.data)||void 0===e?void 0:e.author]}),Object(B.jsx)("p",{children:Object(B.jsx)("a",{href:"".concat(null===(n=p.data)||void 0===n?void 0:n.url),children:null===(r=p.data)||void 0===r?void 0:r.url})}),Object(B.jsxs)("p",{className:"likes",children:[null===(c=p.data)||void 0===c?void 0:c.likes," ",Object(B.jsx)(T.a,{variant:"outline-info",size:"sm",id:"like",onClick:function(t){var e,n;t.preventDefault(),(null===(e=p.data)||void 0===e||null===(n=e.user[0])||void 0===n?void 0:n.username)!==d.username&&u(N("Only the blog creator can add like"));try{var r,a,c,i,o,j,v,b,f={id:null===(r=p.data)||void 0===r?void 0:r.id,user:null===(a=p.data)||void 0===a?void 0:a.user,title:null===(c=p.data)||void 0===c?void 0:c.title,author:null===(i=p.data)||void 0===i?void 0:i.author,url:null===(o=p.data)||void 0===o?void 0:o.url,likes:(null===(j=p.data)||void 0===j?void 0:j.likes)+1};u(function(t){return function(){var e=Object(l.a)(s.a.mark((function e(n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.update(t);case 2:n({type:"UPDATE_BLOG",data:t.id});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}(f)),u(N("Updated the blog ".concat(null===(v=p.data)||void 0===v?void 0:v.title," by ").concat(null===(b=p.data)||void 0===b?void 0:b.author," added"),5))}catch(h){u(N("".concat(h," "),"error"))}},children:"like"})]}),Object(B.jsxs)("p",{children:["added by ",null===(i=p.data)||void 0===i||null===(o=i.user[0])||void 0===o?void 0:o.username]})]})},G=n(95),W=function(){var t=Object(v.c)((function(t){return t.notification}));return console.log(t),null===t?null:Object(B.jsx)("div",{className:t.type,children:t.message&&Object(B.jsx)(G.a,{variant:"success",children:t.message})})},z={login:function(){var t=Object(l.a)(s.a.mark((function t(e,n){var r,a;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r={username:e,password:n},t.next=3,h.a.post("/api/login",r);case 3:return a=t.sent,t.abrupt("return",a.data);case 5:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},R=function(t){return function(){var e=Object(l.a)(s.a.mark((function e(n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n({type:"NEW_USER",data:t});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},D=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0;switch(console.log("STATE NOW:",t),console.log("ACTION:",e),e.type){case"NEW_USER":return e.data;default:return t}},V=n(38),J=function(t){var e=Object(a.useState)(""),n=Object(V.a)(e,2),r=n[0],c=n[1];return{type:t,value:r,onChange:function(t){c(t.target.value)}}},P=function(){var t=J("username"),e=J("password"),n=Object(v.b)(),r=function(){var r=Object(l.a)(s.a.mark((function r(a){var c;return s.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a.preventDefault(),console.log(t.value,e.value),r.prev=2,r.next=5,z.login(t.value,e.value);case 5:return c=r.sent,r.next=8,x.saveUser(c);case 8:n(R(c)),console.log(c),n(N("".concat(c.name," successfully logged in"),5)),r.next=16;break;case 13:r.prev=13,r.t0=r.catch(2),n(N("".concat(r.t0.response.data.error),"error"));case 16:case"end":return r.stop()}}),r,null,[[2,13]])})));return function(t){return r.apply(this,arguments)}}();return Object(B.jsxs)("div",{children:[Object(B.jsx)("h3",{children:"Log in to application"}),Object(B.jsxs)("form",{onSubmit:r,children:[Object(B.jsxs)("div",{children:[Object(B.jsxs)("div",{children:["username",Object(B.jsx)("input",Object(b.a)({id:"username",type:"username"},t))]}),Object(B.jsxs)("div",{children:["password",Object(B.jsx)("input",Object(b.a)({id:"password",type:"password"},e))]})]}),Object(B.jsx)(T.a,{size:"sm",id:"login-button",type:"submit",children:"Submit"})]})]})},H=c.a.forwardRef((function(t,e){var n=Object(a.useState)(!1),r=Object(V.a)(n,2),c=r[0],i=r[1],o={display:c?"none":""},u={display:c?"":"none"},s=function(){i(!c)};return Object(a.useImperativeHandle)(e,(function(){return{toggleVisibility:s}})),Object(B.jsxs)("div",{children:[Object(B.jsx)("div",{style:o,children:Object(B.jsx)(T.a,{id:"toggle",onClick:s,children:t.buttonLabel})}),Object(B.jsxs)("div",{style:u,children:[t.children,Object(B.jsx)(T.a,{size:"sm",variant:"warning",onClick:s,children:"cancel"})]}),Object(B.jsx)("br",{})]})}));H.displayName="Togglable";var q=H,F=n(91),K=function(){var t=Object(v.c)((function(t){return t.blogs}));console.log(t);var e=t.map((function(t){var e;return null===(e=t.data)||void 0===e?void 0:e.user[0]}));if(console.log(e),!t&&!e)return null;var n=e.filter((function(t,e,n){return n.findIndex((function(e){return e.id===t.id}))===e}));console.log(n);return Object(B.jsxs)("div",{children:[Object(B.jsx)("h2",{children:"Users"}),Object(B.jsxs)(F.a,{size:"sm",children:[Object(B.jsx)("thead",{children:Object(B.jsxs)("tr",{children:[Object(B.jsx)("th",{}),Object(B.jsx)("th",{children:"blogs created"})]})}),Object(B.jsx)("tbody",{children:n.map((function(e){return Object(B.jsxs)("tr",{children:[Object(B.jsx)("td",{children:Object(B.jsx)(d.b,{to:"/users/".concat(e.id),children:e.username})}),Object(B.jsx)("td",{children:(n=e.username,r=t,r.filter((function(t){var e,r;return(null===(e=t.data)||void 0===e||null===(r=e.user[0])||void 0===r?void 0:r.username)===n})).length)})]},e.id);var n,r}))})]})]})},Q=function(){var t=Object(v.c)((function(t){return t.blogs})),e=Object(j.f)().id;if(!t&&!e)return null;console.log(e);var n=t.filter((function(t){var n,r;return(null===(n=t.data)||void 0===n||null===(r=n.user[0])||void 0===r?void 0:r.id)===e}));console.log(n);var r=n.map((function(t){var e;return null===(e=t.data)||void 0===e?void 0:e.user[0]}));return console.log(r),Object(B.jsxs)("div",{children:[Object(B.jsx)("h2",{children:r[0].username}),Object(B.jsx)("br",{}),Object(B.jsx)("h5",{children:"added blogs"}),Object(B.jsx)("ul",{children:n.map((function(t){var e,n;return Object(B.jsx)("li",{children:null===(n=t.data)||void 0===n?void 0:n.title},null===(e=t.data)||void 0===e?void 0:e.id)}))})]})},X=n(92),Y=function(t){var e=t.createBlog;return Object(B.jsxs)("div",{children:[Object(B.jsx)("h4",{children:"Create New Blog"}),Object(B.jsx)(X.a,{onSubmit:function(t){t.preventDefault(),e({title:t.target.title.value,author:t.target.author.value,url:t.target.url.value,likes:t.target.likes.value}),t.target.title.value="",t.target.author.value="",t.target.url.value="",t.target.likes.value=""},children:Object(B.jsxs)(X.a.Group,{children:[Object(B.jsx)(X.a.Label,{children:" title:"}),Object(B.jsx)(X.a.Control,{id:"title",type:"text",name:"title"}),Object(B.jsx)(X.a.Label,{children:" author: "}),Object(B.jsx)(X.a.Control,{id:"author",name:"author",type:"text"}),Object(B.jsx)(X.a.Label,{children:"url:"}),Object(B.jsx)(X.a.Control,{id:"url",name:"url"}),Object(B.jsx)(X.a.Label,{children:"likes:"}),Object(B.jsx)(X.a.Control,{id:"likes",name:"likes"}),Object(B.jsx)("br",{}),Object(B.jsx)(T.a,{size:"sm",variant:"primary",id:"create-button",type:"submit",children:"create"})]})})]})},Z=function(){var t=Object(v.b)(),e=Object(a.useRef)(),n=Object(v.c)((function(t){return t.user})),r=Object(v.c)((function(t){return t.blogs}));if(!r&&!n)return null;var c=r.sort((function(t,e){return e.likes-t.likes}));return Object(B.jsxs)("div",{children:[Object(B.jsx)("h1",{children:"Blogs"}),Object(B.jsx)("div",{children:Object(B.jsx)(q,{buttonLabel:"create new blog",ref:e,children:Object(B.jsx)(Y,{createBlog:function(n){try{e.current.toggleVisibility(),t((r=n,function(){var t=Object(l.a)(s.a.mark((function t(e){var n;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,y.create(r);case 2:n=t.sent,e({type:"NEW_BLOG",data:n});case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())),t(N("a new blog ".concat(n.title," by ").concat(n.author," added"),5))}catch(a){t(N("".concat(a," "),"error"))}var r}})})}),c.map((function(t){var e,n,r;return Object(B.jsx)("div",{className:"contact",children:Object(B.jsx)("p",{children:Object(B.jsx)(d.b,{to:"/blogs/".concat(null===(n=t.data)||void 0===n?void 0:n.id),children:null===(r=t.data)||void 0===r?void 0:r.title})})},null===(e=t.data)||void 0===e?void 0:e.id)}))]})},$=n(94),tt=n(93),et=function(){var t,e=Object(v.b)(),n=Object(v.c)((function(t){return t.comments}));if(!n)return null;var r=function(){var t=Object(l.a)(s.a.mark((function t(r){var a,c;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r.preventDefault(),c=r.target.content.value,e(L(n,c)),e(N("Created a new comment ".concat(c," for blog ").concat(null===(a=n.data)||void 0===a?void 0:a.title),5)),r.target.content.value="";case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(B.jsxs)("div",{children:[Object(B.jsx)("h5",{children:"Comments"}),Object(B.jsxs)("div",{children:[Object(B.jsx)("div",{children:Object(B.jsx)("form",{onSubmit:r,children:Object(B.jsxs)("div",{children:[Object(B.jsx)("input",{className:"form",name:"content"}),Object(B.jsx)(T.a,{size:"sm",type:"submit",children:"add comments"})]})})}),Object(B.jsx)("ul",{children:null===(t=n.data)||void 0===t?void 0:t.comments.map((function(t){return Object(B.jsx)("div",{children:Object(B.jsx)("li",{children:t.content})},t.id)}))})]})]})},nt=function(){var t=Object(v.b)(),e=Object(v.c)((function(t){return t.user}));Object(a.useEffect)((function(){t(k());var e=setInterval((function(){t(k())}),1e4);return function(){return clearInterval(e)}}),[t]),Object(a.useEffect)((function(){var e=x.loadUser();e&&t(R(e))}),[t]);var n=function(){var e=Object(l.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.logoutUser();case 2:t(R(null));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(B.jsx)("div",{className:"container",children:Object(B.jsxs)(d.a,{children:[Object(B.jsxs)($.a,{collapseOnSelect:!0,expand:!0,bg:"dark",variant:"dark",children:[Object(B.jsx)($.a.Toggle,{"aria-controls":"responsive-navbar-nav"}),Object(B.jsx)($.a.Collapse,{id:"responsive-navbar-nav",children:Object(B.jsxs)(tt.a,{className:"me-auto",children:[Object(B.jsx)(tt.a.Link,{href:"#",as:"span",children:Object(B.jsx)(d.b,{to:"/blogs",children:"blogs"})}),Object(B.jsx)(tt.a.Link,{href:"#",as:"span",children:Object(B.jsx)(d.b,{to:"/users",children:"users"})}),Object(B.jsx)(tt.a.Link,{href:"#",as:"span",children:null===e?Object(B.jsx)(q,{buttonLabel:"login to application",children:Object(B.jsx)(P,{})}):Object(B.jsxs)("div",{className:"row",children:[Object(B.jsxs)("p",{children:[e.name," logged in"]}),Object(B.jsx)(T.a,{variant:"light",size:"sm",id:"logout",onClick:function(){return n()},children:"logout"})]})})]})})]}),Object(B.jsx)("div",{children:Object(B.jsx)(W,{})}),Object(B.jsx)("br",{}),Object(B.jsxs)(j.c,{children:[Object(B.jsx)(j.a,{path:"/users/:id",children:Object(B.jsx)(Q,{})}),Object(B.jsx)(j.a,{path:"/users",children:Object(B.jsx)(K,{})}),Object(B.jsxs)(j.a,{path:"/blogs/:id",children:[Object(B.jsx)(U,{}),Object(B.jsx)(et,{})]}),Object(B.jsx)(j.a,{path:"/blogs",children:Object(B.jsx)(Z,{})})]})]})})},rt=(n(87),n(31)),at=n(55),ct=n(56),it=Object(rt.combineReducers)({blogs:E,notification:S,user:D,comments:M}),ot=Object(rt.createStore)(it,Object(at.composeWithDevTools)(Object(rt.applyMiddleware)(ct.a)));console.log(ot.getState());var ut=ot;console.log(ut.getState()),o.a.render(Object(B.jsx)(v.a,{store:ut,children:Object(B.jsx)(nt,{})}),document.getElementById("root"))}},[[88,1,2]]]);
//# sourceMappingURL=main.9533ca7f.chunk.js.map